<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Простой поиск счетчиков в системе Аршин">
    <meta name="keywords" content="Аршин,счетчик,заводской номер,поверка">
    <title>Публичный портал проверки средств измерений (СИ) в ФГИС «Аршин»</title>

    <!-- Yandex.Metrika informer -->
    <a href="https://metrika.yandex.com/stat/?id=89295190&amp;from=informer"
    target="_blank" rel="nofollow"><img src="https://informer.yandex.ru/informer/89295190/3_1_FFFFFFFF_EFEFEFFF_0_pageviews"
    style="width:88px; height:31px; border:0; position: fixed; right: 5px; bottom: 10px; z-index: 10" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" class="ym-advanced-informer" data-cid="89295190" data-lang="ru" /></a>
    <!-- /Yandex.Metrika informer -->

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(89295190, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/89295190" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <link rel="stylesheet" href="style.css">
    <script src="counter.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.9/dist/inputmask.min.js"></script>

</head>
<body onload="init()">

<div class="tabs">
    <a class="label activeTab">Счетчики</a>
    <a class="label inactiveTab" href="aiis.html">АИИС КУЭ</a>
    <div class="filler"></div>
</div>

<div id="main" style="padding-top: 10px;">
    <form>
        <h2 style="margin-top: 0;">Выберите год поверки счетчика:</h2>
        <div id="yearsList" class="radio-toolbar">
<!--            <input type="radio" id="year2020" name="year" value="2020"/><label for="year2020">2020</label>-->
        </div>
        <h2 style="margin-top: 0;">Выберите месяц поверки счетчика:</h2>
        <div class="radio-toolbar" style="margin-bottom: 15px;">
            <input type="radio" id="month01" name="month" value="01"/><label for="month01">Январь</label>
            <input type="radio" id="month02" name="month" value="02"/><label for="month02">Февраль</label>
            <input type="radio" id="month03" name="month" value="03"/><label for="month03">Март</label>
            <input type="radio" id="month04" name="month" value="04"/><label for="month04">Апрель</label>
            <input type="radio" id="month05" name="month" value="05"/><label for="month05">Май</label>
            <input type="radio" id="month06" name="month" value="06"/><label for="month06">Июнь</label>
            <input type="radio" id="month07" name="month" value="07"/><label for="month07">Июль</label>
            <input type="radio" id="month08" name="month" value="08"/><label for="month08">Август</label>
            <input type="radio" id="month09" name="month" value="09"/><label for="month09">Сентябрь</label>
            <input type="radio" id="month10" name="month" value="10"/><label for="month10">Октябрь</label>
            <input type="radio" id="month11" name="month" value="11"/><label for="month11">Ноябрь</label>
            <input type="radio" id="month12" name="month" value="12"/><label for="month12">Декабрь</label>
        </div>
        <input type="text" size="45" id="serial" name="serial" placeholder="Введите заводской номер счетчика"
               oninput="resetErrors()" onkeydown="keyDown(event)" autofocus>
        <input type="button" id="btnSearch" value="Найти" onclick="search()">
    </form>
</div>

<dialog id="contactDialog" style="position: relative; padding-top: 1.5rem; border-radius: 0.5rem; width: 400px;">
    <button class="close-icon" id="btn-close">&times;</button>
    <div style="display: flex; flex-direction: column;">
        <div id="input-error">Укажите номер телефона</div>
        <label for="fio" id="fioLabel">ФИО:</label>
        <input type="text" id="fio" autofocus required>

        <div style="padding-top: 15px;"></div>

        <label for="phone" id="phoneLabel">Телефон:</label>
        <input type="tel" id="phone" required>

        <div style="padding-top: 30px;"></div>

        <button type="button" id="btn-send">Отправить</button>
    </div>
</dialog>

<div id="result">
    <div style="border: 1px dashed black; width: fit-content; padding: 15px 20px; margin-top: 15px;">
        <div style="display: flex; align-items: center;">
            <span style="font-size: 14pt; font-weight: bold; color: black; padding-right: 30px;">
                Поверить счетчики в ЦСМ<br>Аттестат аккредитации: RA.RU.314388
            </span>
            <a href="https://poverka911.ru" target="_blank" id="bannerLink">
                Подать заявку
            </a>
        </div>
    </div>
</div>

<div id="footer"><a href="help.html" target="_blank">Помощь</a></div>

<script >
    const dialog = document.getElementById("contactDialog");

    const bannerLink = document.getElementById("bannerLink");
    bannerLink.addEventListener("click", (e) => {
        if (e.shiftKey) {
            e.preventDefault();
            dialog.showModal();
        }
    });

    const btnClose = document.getElementById("btn-close");
    btnClose.addEventListener("click", () => dialog.close());

    dialog.addEventListener("click", (e) => {
        const rect = dialog.getBoundingClientRect();
        const isInDialog = e.clientX >= rect.left && e.clientX <= rect.right && e.clientY >= rect.top && e.clientY <= rect.bottom;
        if (!isInDialog) {
            dialog.close();
        }
    });

    const fioInput = document.getElementById("fio");
    const phoneInput = document.getElementById("phone");
    const im = new Inputmask("+7 (999) 999-99-99");
    im.mask(phoneInput);

    async function sendRequest(fio, phone, onSuccess) {
        const ts = Date.now();
        const str = fio + ts + phone;
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const ch = str.charCodeAt(i);
            hash = (hash << 5) - hash + ch;
            hash |= 0; // Convert to 32bit integer
        }
        const postData = {
            fio: fio,
            phone: phone,
            ts: ts,
            hash: hash
        };
        const response = await fetch("/arshin/apply", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(postData)
        });
        if (response.ok) {
            onSuccess();
        }
    }

    const btnSend = document.getElementById("btn-send");
    btnSend.addEventListener("click", () => {
        if (!phoneInput.inputmask.isComplete()) {
            const inputError = document.getElementById("input-error");
            inputError.style.display = "block";
            phoneInput.style.borderColor = "red";
            phoneInput.focus();
            return;
        }
        const fio = fioInput.value;
        const phone = phoneInput.value;
        sendRequest(fio, phone, () => dialog.close());
    });
</script>

</body>
</html>
